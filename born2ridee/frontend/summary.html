<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="View your complete trip summary">
    <title>Trip Summary - Born 2 Ride</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">

    <style>
        .summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            overflow: hidden;
            margin-bottom: var(--space-6);
        }

        .summary-header {
            padding: var(--space-6);
            background: var(--primary-gradient);
            text-align: center;
        }

        .summary-header-icon {
            font-size: 3rem;
            margin-bottom: var(--space-2);
        }

        .summary-header-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: var(--space-1);
        }

        .summary-header-subtitle {
            color: rgba(255, 255, 255, 0.8);
        }

        .summary-body {
            padding: var(--space-6);
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-4);
            border-bottom: 1px solid var(--border-color);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-item-label {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            color: var(--text-secondary);
        }

        .summary-item-value {
            font-weight: 600;
            font-size: 1.125rem;
        }

        .summary-total {
            background: rgba(255, 107, 53, 0.1);
            border-radius: var(--radius-lg);
            margin: var(--space-4);
            padding: var(--space-4);
        }

        .summary-total .summary-item-label,
        .summary-total .summary-item-value {
            color: var(--primary-500);
            font-size: 1.25rem;
            font-weight: 700;
        }

        .stops-summary {
            margin-top: var(--space-8);
        }

        .stops-summary-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }

        .stops-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .stop-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3);
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
        }

        .stop-icon {
            font-size: 1.5rem;
        }

        .stop-info {
            flex: 1;
        }

        .stop-name {
            font-weight: 500;
        }

        .stop-type {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: capitalize;
        }

        .empty-stops {
            text-align: center;
            padding: var(--space-8);
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            color: var(--text-secondary);
        }

        .save-trip-section {
            margin-top: var(--space-8);
            text-align: center;
        }

        .trip-saved-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-6);
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: var(--radius-full);
            color: var(--success);
            margin-top: var(--space-4);
        }

        .no-trip-card {
            text-align: center;
            padding: var(--space-12);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
        }

        .no-trip-icon {
            font-size: 4rem;
            margin-bottom: var(--space-4);
        }

        .share-buttons {
            display: flex;
            gap: var(--space-4);
            justify-content: center;
            margin-top: var(--space-6);
        }

        .share-btn {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-5);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .share-btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--primary-500);
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container flex items-center justify-between" style="max-width: 100%; padding: 0 var(--space-6);">
            <a href="index.html" class="nav-brand">
                <span class="logo-icon">üèçÔ∏è</span>
                <span class="gradient-text">Born 2 Ride</span>
            </a>

            <div class="nav-links">
                <a href="home.html" class="nav-link">Home</a>
                <a href="stops.html" class="nav-link">Stops</a>
                <a href="sos.html" class="nav-link">SOS</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="page">
        <div class="container" style="max-width: 600px;">
            <!-- Page Header -->
            <div class="page-header text-center">
                <h1 class="page-title">Trip <span class="gradient-text">Summary</span></h1>
                <p class="page-subtitle">Complete breakdown of your journey</p>
            </div>

            <!-- Content Container -->
            <div id="summaryContent">
                <div class="text-center" style="padding: var(--space-12);">
                    <div class="loader" style="margin: 0 auto;"></div>
                    <p style="color: var(--text-secondary); margin-top: var(--space-4);">Loading summary...</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="home.html" class="bottom-nav-item">
            <span class="nav-icon">üè†</span>
            <span>Home</span>
        </a>
        <a href="stops.html" class="bottom-nav-item">
            <span class="nav-icon">üçΩÔ∏è</span>
            <span>Stops</span>
        </a>
        <a href="sos.html" class="bottom-nav-item">
            <span class="nav-icon">üö®</span>
            <span>SOS</span>
        </a>
        <a href="summary.html" class="bottom-nav-item active">
            <span class="nav-icon">üìä</span>
            <span>Summary</span>
        </a>
    </nav>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const trip = TripStorage.get();
            const container = document.getElementById('summaryContent');

            if (!trip || !trip.destination) {
                container.innerHTML = `
                    <div class="no-trip-card animate-fade-in">
                        <div class="no-trip-icon">üìä</div>
                        <h3>No Trip Data</h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--space-6);">
                            You haven't planned a trip yet. Start by entering your destination.
                        </p>
                        <a href="home.html" class="btn btn-primary">
                            <span>üöÄ</span>
                            Plan a Trip
                        </a>
                    </div>
                `;
                return;
            }

            // Calculate time
            const estimatedTime = Math.round(trip.distance_km / 60);
            const hours = Math.floor(estimatedTime);
            const minutes = Math.round((estimatedTime - hours) * 60);
            const timeString = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;

            // Get stops
            const stops = trip.stops || [];

            // Render stops HTML
            let stopsHTML = '';
            if (stops.length > 0) {
                stopsHTML = `
                    <div class="stops-list">
                        ${stops.map(stop => `
                            <div class="stop-item">
                                <span class="stop-icon">${Utils.getVendorIcon(stop.type)}</span>
                                <div class="stop-info">
                                    <div class="stop-name">${stop.name}</div>
                                    <div class="stop-type">${stop.type}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                stopsHTML = `
                    <div class="empty-stops">
                        <p>No stops added yet</p>
                        <a href="stops.html" style="color: var(--primary-500);">+ Add Stops</a>
                    </div>
                `;
            }

            container.innerHTML = `
                <!-- Main Summary Card -->
                <div class="summary-card animate-fade-in">
                    <div class="summary-header">
                        <div class="summary-header-icon">${trip.vehicle_type === 'bike' ? 'üèçÔ∏è' : 'üöó'}</div>
                        <div class="summary-header-title">${trip.origin} ‚Üí ${trip.destination}</div>
                        <div class="summary-header-subtitle">${trip.vehicle_type.charAt(0).toUpperCase() + trip.vehicle_type.slice(1)} Trip</div>
                    </div>
                    
                    <div class="summary-body">
                        <div class="summary-item">
                            <span class="summary-item-label">
                                <span>üìç</span>
                                From
                            </span>
                            <span class="summary-item-value">${trip.origin}</span>
                        </div>
                        
                        <div class="summary-item">
                            <span class="summary-item-label">
                                <span>üéØ</span>
                                To
                            </span>
                            <span class="summary-item-value">${trip.destination}</span>
                        </div>
                        
                        <div class="summary-item">
                            <span class="summary-item-label">
                                <span>üìè</span>
                                Distance
                            </span>
                            <span class="summary-item-value">${trip.distance_km} km</span>
                        </div>
                        
                        <div class="summary-item">
                            <span class="summary-item-label">
                                <span>‚è±Ô∏è</span>
                                Estimated Time
                            </span>
                            <span class="summary-item-value">${timeString}</span>
                        </div>
                        
                        <div class="summary-item">
                            <span class="summary-item-label">
                                <span>üõ¢Ô∏è</span>
                                Fuel Required
                            </span>
                            <span class="summary-item-value">${parseFloat(trip.fuel_liters || 0).toFixed(1)} L</span>
                        </div>
                        
                        <div class="summary-item">
                            <span class="summary-item-label">
                                <span>üí∞</span>
                                Fuel Price
                            </span>
                            <span class="summary-item-value">‚Çπ${trip.fuel_price || 104}/L</span>
                        </div>
                        
                        <div class="summary-item">
                            <span class="summary-item-label">
                                <span>üó∫Ô∏è</span>
                                Stops Added
                            </span>
                            <span class="summary-item-value">${stops.length}</span>
                        </div>
                    </div>
                    
                    <div class="summary-total">
                        <div class="summary-item" style="border: none; padding: var(--space-2) 0;">
                            <span class="summary-item-label">
                                <span>üíµ</span>
                                Total Fuel Cost
                            </span>
                            <span class="summary-item-value">‚Çπ${parseFloat(trip.fuel_cost || 0).toFixed(0)}</span>
                        </div>
                    </div>
                </div>
                
                <!-- Stops Summary -->
                <div class="stops-summary animate-fade-in delay-1">
                    <div class="stops-summary-header">
                        <h3 style="display: flex; align-items: center; gap: var(--space-2);">
                            <span>üìç</span>
                            Stops Visited
                        </h3>
                        <a href="stops.html" class="btn btn-secondary" style="padding: var(--space-2) var(--space-4); font-size: 0.875rem;">
                            + Add More
                        </a>
                    </div>
                    ${stopsHTML}
                </div>
                
                <!-- Save/Share Section -->
                <div class="save-trip-section animate-fade-in delay-2">
                    <button class="btn btn-primary btn-lg" id="saveTripBtn">
                        <span>üíæ</span>
                        Save Trip to Server
                    </button>
                    
                    <div class="trip-saved-badge" id="savedBadge" style="display: none;">
                        <span>‚úì</span>
                        Trip saved successfully!
                    </div>
                    
                    <div class="share-buttons">
                        <button class="share-btn" id="copyBtn">
                            <span>üìã</span>
                            Copy Summary
                        </button>
                        <button class="share-btn" id="newTripBtn">
                            <span>üîÑ</span>
                            New Trip
                        </button>
                    </div>
                </div>
            `;

            // Save trip button
            document.getElementById('saveTripBtn').addEventListener('click', async function () {
                this.innerHTML = '<div class="loader" style="width: 20px; height: 20px;"></div> Saving...';
                this.disabled = true;

                try {
                    const tripData = {
                        origin: trip.origin,
                        destination: trip.destination,
                        distance_km: trip.distance_km,
                        vehicle_type: trip.vehicle_type,
                        stops_visited: trip.stops || []
                    };

                    const result = await API.createTrip(tripData);

                    document.getElementById('savedBadge').style.display = 'inline-flex';
                    this.innerHTML = '<span>‚úì</span> Saved!';
                    this.style.background = 'var(--success)';

                    Utils.showToast('Trip saved to server!', 'success');

                } catch (error) {
                    console.error('Error saving trip:', error);
                    this.innerHTML = '<span>üíæ</span> Save Trip to Server';
                    this.disabled = false;
                    Utils.showToast('Saved locally (server offline)', 'success');
                    document.getElementById('savedBadge').style.display = 'inline-flex';
                }
            });

            // Copy summary
            document.getElementById('copyBtn').addEventListener('click', function () {
                const summary = `
üèçÔ∏è Born 2 Ride - Trip Summary

üìç From: ${trip.origin}
üéØ To: ${trip.destination}
üìè Distance: ${trip.distance_km} km
‚è±Ô∏è Time: ${timeString}
üöó Vehicle: ${trip.vehicle_type}
üõ¢Ô∏è Fuel: ${parseFloat(trip.fuel_liters || 0).toFixed(1)} L
üíµ Cost: ‚Çπ${parseFloat(trip.fuel_cost || 0).toFixed(0)}
üìç Stops: ${stops.length}

Safe travels! üöÄ
                `.trim();

                navigator.clipboard.writeText(summary).then(() => {
                    Utils.showToast('Summary copied!', 'success');
                }).catch(() => {
                    Utils.showToast('Could not copy', 'error');
                });
            });

            // New trip
            document.getElementById('newTripBtn').addEventListener('click', function () {
                if (confirm('Start a new trip? Current data will be cleared.')) {
                    TripStorage.clear();
                    window.location.href = 'home.html';
                }
            });
        });
    </script>
</body>

</html>